<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper
PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
"http://mybatis.org/dtd/mybatis-3-mapper.dtd">


    
<mapper namespace="socialUp.service.content.mapper">

	 <resultMap id="selectContentDtlCommentListResult" type="socialUp.service.content.dto.ContentDtlCommentDTO" >
	        <result column="cdc_no" property="cdc_no" />
	        <result column="cd_no" property="cd_no" />
	        <result column="comment" property="comment" />
	        <result column="use_yn" property="use_yn" />
	        <result column="mt_no" property="mt_no" />
	        <result column="create_dt" property="create_dt" />
	        <result column="create_no" property="create_no" />
	        <result column="update_dt" property="update_dt" />
	        <result column="update_no" property="update_no" />
	        <result column="mem_nm" 	property="memTblDTO.mem_nm" />
	        
	 </resultMap>
	    
	<select id="selectContentDtlCommentList" resultMap="selectContentDtlCommentListResult" parameterType="socialUp.service.content.dto.ContentDtlCommentDTO">
	     	select /*selectContentDtlComment 2010.12.16*/
	     			cdc.cdc_no
				,	cdc.cd_no
				,	cdc.comment
				,	cdc.use_yn
				,	cdc.mt_no
				,	cdc.create_dt
				,	cdc.create_no
				,	cdc.update_dt
				,	cdc.update_no
				,   mt.mem_nm
			from content_dtl_comment cdc , mem_tbl mt where cdc.cd_no = #{cd_no}
			and cdc.use_yn = 'Y'
			and cdc.mt_no = mt.mt_no
			
			<if test="cdc_no != null and cdc_no != ''">
				and cdc.cdc_no = #{cdc_no}
			</if>
			
			<!-- 넘오온 cdc_no_gt 값보다  큰값만 조회 -->
			<if test="cdc_no_gt != null and cdc_no_gt != ''">
				and cdc.cdc_no > #{cdc_no_gt}
			</if>
			
			order by cdc.cdc_no desc
			
			
	</select>
    	
    <insert id="insertContentDtlComment" parameterType="socialUp.service.content.dto.ContentDtlCommentDTO">
			INSERT INTO /*insertContentDtlComment 2010.12.16*/ content_dtl_comment(
					cd_no
				,	comment
				,	use_yn
				,	mt_no
				,	create_dt
				,	create_no
					)
			VALUES(
					#{cd_no}
				,	#{comment}
				,	#{use_yn}
				,	#{mt_no}
				,	DATE_FORMAT(#{create_dt},'%Y%m%d%H%i%s')
				,	#{create_no}
					)
    	<selectKey resultType="String" keyProperty="cdc_no"> select last_insert_id() as cdc_no </selectKey>
    </insert>
	
	
	<update id="updateContentDtlComment" parameterType="socialUp.service.content.dto.ContentDtlCommentDTO">
  		update  /*updateContentDtlComment 2010.12.16*/  content_dtl_comment set
					update_dt  = DATE_FORMAT(#{create_dt},'%Y%m%d%H%i%s')
					,update_no	= #{create_no}
					
					<if test="comment != null and comment != '' ">
						,comment = #{comment}
					</if>
					
					<if test="use_yn != null and use_yn != '' ">
						,use_yn = #{use_yn}
					</if>
					
  		where  cdc_no = #{cdc_no}
  		<if test="mt_no != null and mt_no != ''">
  			and mt_no = #{mt_no}
  		</if>
  	</update>
  	
</mapper>

